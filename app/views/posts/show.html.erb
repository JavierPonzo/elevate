<div class="container my-5">
  <div class="row">
    <!-- Main Content -->
    <div class="col-md-8">
      <h1 class="hero-title mb-3"><%= @post.title %></h1>
      <% @post.photos.each do |photo| %>
        <%= cl_image_tag photo.key, class: "banner-image img-fluid mb-3 shadow", style: "width: 100%; object-fit: cover;", alt: @post.title %>
      <% end %>
      <div class="mb-4">
        <%= @post.rich_content.body.to_s.html_safe %>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-md-4">
      <% if current_user&.==(@post.doctor.user) %>
        <div class="card p-4 shadow-sm mb-4">
          <div class="d-flex justify-content-around">
            <%= link_to t('appointment.edit'), edit_post_path(@post), class: 'btn btn-primary btn-lg rounded-pill' %>
            <%= link_to t('appointment.delete'), post_path(@post), data: { turbo_method: :delete, turbo_confirm: t('appointment.confirm_delete') }, class: "btn btn-danger btn-lg rounded-pill" %>
          </div>
        </div>
      <% else %>
        <div class="card p-4 shadow-sm text-center mb-4">
          <% if @post.doctor.user.photo.attached? %>
            <%= cl_image_tag @post.doctor.user.photo.key, class: "img-thumbnail rounded-circle mb-3", style: "height: 120px; width: 120px; object-fit: cover;", alt: t('profile.no_photo') %>
          <% else %>
            <%= image_tag "default_user.jpg", class: "img-thumbnail rounded-circle mb-3", style: "height: 120px; width: 120px; object-fit: cover;", alt: t('profile.no_photo') %>
          <% end %>
          <p><strong><%= t('appointment.doctor') %>:</strong> <%= @post.doctor.user.full_name %></p>
          <p><strong><%= t('appointment.specialty') %>:</strong> <%= @post.doctor.specialty %></p>
          <p><strong><%= t('appointment.license') %>:</strong> <%= @post.doctor.license %></p>
          <button type="button" class="btn btn-primary btn-lg rounded-pill mt-3" data-bs-toggle="modal" data-bs-target="#appointmentModal">
            <%= t('appointment.neww') %>
          </button>
        </div>
      <% end %>

      <!-- Reviews -->
      <div class="p-4">
        <h2 class="hero-title mb-3"><%= t('post.reviews') %></h2>
        <ul class="list-group">
          <% @post.reviews.each do |review| %>
            <li class="list-group-item">
              <small>
                <% (1..5).each do |i| %>
                  <i class="fa-<%= review.rating >= i ? 'solid' : 'regular' %> fa-star"></i>
                <% end %>
              </small>
              <p><%= review.content %></p>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Appointment Modal -->
<div class="modal fade" id="appointmentModal" tabindex="-1" aria-labelledby="appointmentModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="appointmentModalLabel"><%= t('appointment.new') %></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <%= form_with(model: @appointment, local: true) do |form| %>
          <%= form.hidden_field :doctor_id, value: @post.doctor.id %>
          <%= form.date_field :date, class: "form-control mb-3", min: Date.tomorrow %>
          <%= form.select :time, options_for_select((8..20).map { |h| ["#{format('%02d', h)}:00", "#{format('%02d', h)}:00"] }), {}, class: "form-control mb-3" %>
          <%= form.text_area :details, class: "form-control", rows: 4 %>
          <div class="text-center mt-3">
            <%= form.submit t('appointment.create_appointment'), class: "btn btn-primary btn-lg" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Q&A Section -->
<div class="container my-5">
  <h2 class="hero-title mb-3"><%= t('post.questions') %></h2>
  <%= simple_form_for [@post, QuestionAnswer.new] do |f| %>
    <div class="mb-3">
      <%= f.text_field :question, class: "form-control", placeholder: t('post.ask_question') %>
    </div>
    <%= f.submit t('post.ask'), class: "btn btn-primary" %>
  <% end %>
  <div class="list-group mt-4">
    <% @post.question_answers.each do |qa| %>
      <div class="list-group-item">
        <p><strong><%= t('post.question') %>:</strong> <%= qa.question %></p>
        <p><strong><%= t('post.answer') %>:</strong> <%= qa.answer.presence || t('post.no_answer_yet') %></p>
      </div>
    <% end %>
  </div>
</div>

<!-- Back Button -->
<div class="text-center my-5">
  <%= link_to t('post.back_to_articles'), posts_path, class: "btn btn-outline-primary" %>
</div>
